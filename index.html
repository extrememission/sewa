<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Exercises Journal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <style>
        /* --- Basic Setup & Typography --- */
        :root {
            --primary-bg: #fdfaf5;
            --secondary-bg: #ffffff;
            --text-color: #3a3a3a;
            --heading-color: #1a2c42;
            --accent-color: #8a6d46;
            --border-color: #e0d9cf;
            --shadow-color: rgba(0, 0, 0, 0.05);
            --favorite-star-color: #f3d23e;
        }

        body {
            font-family: 'Source Sans 3', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            line-height: 1.6;
        }

        h1, h2, h3, h4 {
            font-family: 'Lora', serif;
            color: var(--heading-color);
            font-weight: 600;
        }

        /* --- Main Layout (App Container) --- */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Sidebar (Navigation) --- */
        .sidebar {
            width: 320px;
            background-color: var(--secondary-bg);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 15px var(--shadow-color);
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
        .sidebar-header h2 { margin: 0; font-size: 1.5rem; }
        .sidebar-header p { font-size: 0.9rem; color: #777; margin: 5px 0 0; }

        .data-management-buttons { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border-color); margin-bottom: 10px; }
        .io-button { background: #f7f3ed; border: 1px solid var(--border-color); color: var(--accent-color); padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: background-color 0.2s; flex-basis: 45%; text-align: center;}
        .io-button:hover { background-color: #f0ebe4; }
        #home-button, #favorites-button { background-color: var(--accent-color); color: white; }
        #home-button:hover, #favorites-button:hover { background-color: #6d5635; }


        #navigation-menu { flex-grow: 1; }

        /* Accordion Styles */
        .category-list h3 { margin-top: 15px; margin-bottom: 0; font-size: 1.1rem; color: var(--accent-color); padding: 10px; cursor: pointer; border-radius: 6px; transition: background-color 0.2s; position: relative; }
        .category-list h3::after { content: '+'; position: absolute; right: 15px; font-weight: bold; }
        .category-list.open > h3::after { content: '−'; }
        .category-list.open > h3 { background-color: #f0ebe4; }
        
        .exercise-list { list-style: none; padding: 0; margin: 0; max-height: 0; overflow: hidden; transition: max-height 0.3s ease-in-out; }
        .category-list.open .exercise-list { max-height: 1000px; }
        .exercise-list-item a { display: block; padding: 10px 15px 10px 25px; text-decoration: none; color: var(--text-color); border-radius: 6px; margin-bottom: 5px; transition: background-color 0.2s, color 0.2s; font-weight: 500; }
        .exercise-list-item a:hover { background-color: #f0ebe4; }
        .exercise-list-item a.active { background-color: var(--accent-color); color: white; font-weight: 700; }
        
        /* --- Main Content Area --- */
        .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .welcome-view, .exercise-view, .favorites-view { max-width: 800px; margin: 0 auto; }
        
        /* Welcome & Favorites View Styles */
        .welcome-view, .favorites-view { text-align: center; padding-top: 5vh; }
        .welcome-view h1, .favorites-view h1 { font-size: 2.5rem; }
        .welcome-view p { font-size: 1.2rem; color: #555; }
        #name-prompt { text-align: center; }
        #name-prompt p { margin-bottom: 15px; }
        #name-prompt input { 
            display: block;
            margin: 0 auto 15px auto;
            font-size: 1.1rem; 
            padding: 10px; 
            border-radius: 6px; 
            border: 1px solid var(--border-color); 
            width: 300px; 
            text-align: center; 
        }
        #name-prompt button { font-size: 1.1rem; padding: 10px 20px; }
        #favorites-section { margin-top: 40px; text-align: left; }
        #favorites-list { list-style: none; padding: 0; }
        #favorites-list li { background: white; margin-bottom: 8px; border-radius: 6px; box-shadow: 0 2px 5px var(--shadow-color); }
        #favorites-list a { display: block; padding: 15px; text-decoration: none; color: var(--heading-color); font-weight: 600; transition: background-color 0.2s; border-radius: 6px; }
        #favorites-list a:hover { background-color: #f7f3ed; }

        /* Exercise View Styles */
        .exercise-header { display: flex; justify-content: space-between; align-items: center; }
        .exercise-view h1 { margin-top: 0; font-size: 2.2rem; }
        #favorite-star { font-size: 2rem; cursor: pointer; color: #ccc; transition: color 0.2s, transform 0.2s; }
        #favorite-star.favorited { color: var(--favorite-star-color); transform: scale(1.2); }

        .exercise-scripture { font-family: 'Lora', serif; font-style: italic; font-size: 1.1rem; padding: 15px; background-color: #f7f3ed; border-left: 4px solid var(--accent-color); border-radius: 4px; margin: 20px 0; }
        .exercise-scripture strong { font-weight: 600; color: var(--heading-color); }
        
        #entry-history-list { margin-top: 30px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .historical-entry { background-color: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px var(--shadow-color); }
        .entry-meta { font-size: 0.9rem; font-weight: 600; color: var(--accent-color); margin-bottom: 10px; }
        .entry-text { white-space: pre-wrap; /* Preserves line breaks */ }

        .new-entry-area label { display: block; font-family: 'Lora', serif; font-weight: 600; font-size: 1.2rem; margin-bottom: 10px; margin-top: 30px; }
        .journal-textarea { width: 100%; min-height: 150px; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; font-family: 'Source Sans 3', sans-serif; font-size: 1rem; line-height: 1.7; resize: vertical; box-shadow: inset 0 1px 4px var(--shadow-color); }
        .journal-textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(138, 109, 70, 0.2); }
        .save-button { display: inline-block; background-color: var(--accent-color); color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s, transform 0.1s; margin-top: 20px; }
        .save-button:hover { background-color: #6d5635; }
        .save-button:active { transform: scale(0.98); }
        #save-feedback { display: inline-block; margin-left: 15px; color: green; font-weight: bold; opacity: 0; transition: opacity 0.5s; }

        /* History Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 900px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .modal-header h2 { margin: 0; }
        .modal-close { font-size: 2rem; font-weight: bold; cursor: pointer; border: none; background: none; }
        .modal-filters { display: flex; gap: 20px; margin-bottom: 20px; align-items: center; }
        .modal-filters label { font-weight: 600; }
        .modal-filters input { padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; }
        .modal-body { overflow-y: auto; }
        .history-table { width: 100%; border-collapse: collapse; }
        .history-table th, .history-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        .history-table th { cursor: pointer; position: relative; }
        .history-table th:hover { background-color: #f7f3ed; }
        .history-table th .sort-indicator { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); }

        /* Mobile Responsiveness */
        .mobile-menu-toggle { display: none; position: fixed; top: 15px; left: 15px; z-index: 1001; background-color: var(--accent-color); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .mobile-menu-toggle { display: block; }
            .sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; z-index: 1000; transform: translateX(-100%); box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
            .sidebar.open { transform: translateX(0); }
            .main-content { padding: 20px; padding-top: 80px; }
            .exercise-view h1 { font-size: 1.8rem; }
            .modal-filters { flex-direction: column; align-items: stretch; }
        }

    </style>
</head>
<body>

    <div class="app-container">
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">&#9776;</button>

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>The Believer's Walk</h2>
                <p>A Journal of Spiritual Exercises</p>
            </div>
            
            <div class="data-management-buttons">
                <button id="home-button" class="io-button">Home</button>
                <button id="favorites-button" class="io-button">Favorites</button>
                <button id="export-button" class="io-button">Export</button>
                <button id="import-button" class="io-button">Import</button>
                <button id="history-button" class="io-button" style="flex-basis: 95%;">View History</button>
                <input type="file" id="import-file-input" style="display: none;" accept=".json">
            </div>

            <nav id="navigation-menu"></nav>
        </aside>

        <main class="main-content" id="main-content">
            <div class="welcome-view" id="welcome-view">
                <h1 id="welcome-header">Welcome, Extreme Mission Christian.</h1>
                <div id="name-prompt">
                    <p>To personalize your app, enter a nickname or inspiring appellation.</p>
                    <input type="text" id="name-input" placeholder="e.g., Jim, Jane, Ambassador for Christ">
                    <button id="name-submit" class="save-button">Begin</button>
                </div>
                <p id="welcome-message">Select an exercise from the menu to begin.</p>
            </div>

            <div class="favorites-view" id="favorites-view" style="display: none;">
                <h1>Favorite Exercises</h1>
                <div id="favorites-section">
                    <ul id="favorites-list"></ul>
                </div>
            </div>

            <div class="exercise-view" id="exercise-view" style="display: none;">
                <div class="exercise-header">
                    <h1 id="exercise-title"></h1>
                    <span id="favorite-star" title="Mark as Favorite">&#9733;</span>
                </div>
                <div class="exercise-scripture">
                    <p id="exercise-explanation"></p>
                    <strong id="exercise-reference"></strong>
                </div>

                <div id="entry-history-list">
                    <!-- Historical entries will be populated here -->
                </div>

                <div class="new-entry-area">
                    <label for="journal-entry">Add a New Entry</label>
                    <textarea id="journal-entry" class="journal-textarea" placeholder="Write your new reflections here..."></textarea>
                    <button class="save-button" id="save-button">Add Entry</button>
                    <span id="save-feedback">Entry Added!</span>
                </div>
            </div>
        </main>
    </div>

    <!-- History Report Modal -->
    <div class="modal-overlay" id="history-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Journal History</h2>
                <button class="modal-close" id="modal-close-button">&times;</button>
            </div>
            <div class="modal-filters">
                <div>
                    <label for="start-date">From:</label>
                    <input type="date" id="start-date">
                </div>
                <div>
                    <label for="end-date">To:</label>
                    <input type="date" id="end-date">
                </div>
                <button id="filter-button" class="io-button">Apply Filter</button>
            </div>
            <div class="modal-body">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th data-sort="date">Date <span class="sort-indicator"></span></th>
                            <th data-sort="category">Category <span class="sort-indicator"></span></th>
                            <th data-sort="exercise">Exercise <span class="sort-indicator"></span></th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- Rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
    // --- DATA: The 100 Spiritual Exercises ---
    const spiritualExercises = [
        { id: 1, category: 'Prayer & Supplication', title: 'The Morning Watch', explanation: 'Begin your day with prayer and dedication to God.', reference: 'Psalm 5:3' },
        { id: 2, category: 'Prayer & Supplication', title: 'Evening Prayer', explanation: 'End your day with thanks, committing it to God.', reference: 'Psalm 4:8' },
        { id: 3, category: 'Prayer & Supplication', title: 'The Model Prayer', explanation: 'Pray the prayer Jesus taught His disciples as guide.', reference: 'Matthew 6:9-13' },
        { id: 4, category: 'Prayer & Supplication', title: 'Praying in Secret', explanation: 'Find a private place to commune alone with God.', reference: 'Matthew 6:6' },
        { id: 5, category: 'Prayer & Supplication', title: 'Intercessory Prayer', explanation: 'Pray specifically for the needs and salvation of others.', reference: '1 Timothy 2:1' },
        { id: 6, category: 'Prayer & Supplication', title: 'Prayer of Thanksgiving', explanation: 'Offer prayers focused entirely on gratitude for God\'s blessings.', reference: 'Philippians 4:6' },
        { id: 7, category: 'Prayer & Supplication', title: 'A Prayer of Confession', explanation: 'Humbly confess your specific sins to God for forgiveness.', reference: '1 John 1:9' },
        { id: 8, category: 'Prayer & Supplication', title: 'Praying Scripture', explanation: 'Pray the words of a Psalm or another passage back to God.', reference: '2 Samuel 7:27' },
        { id: 9, category: 'Prayer & Supplication', title: 'Prayer Walking', explanation: 'Walk through your community while praying for its people.', reference: '2 Chronicles 7:14' },
        { id: 10, category: 'Prayer & Supplication', title: 'Ceaseless Prayer', explanation: 'Maintain a constant attitude of prayer throughout your day.', reference: '1 Thessalonians 5:17' },
        { id: 11, category: 'Prayer & Supplication', title: 'Pray for Enemies', explanation: 'Ask God to bless and save those who persecute you.', reference: 'Matthew 5:44' },
        { id: 12, category: 'Prayer & Supplication', 'title': 'Prayer Journaling', 'explanation': 'Write down your prayers and God\'s answers to remember faithfulness.', 'reference': 'Habakkuk 2:2' },
        { id: 13, category: 'Prayer & Supplication', title: 'Family Altar', explanation: 'Lead your family in a dedicated time of prayer.', reference: 'Genesis 35:2-3' },
        { id: 14, category: 'Prayer & Supplication', title: 'Fasting & Prayer', explanation: 'Abstain from food for a time to focus on God.', reference: 'Matthew 17:21' },
        { id: 15, category: 'Prayer & Supplication', title: 'Praying for Labourers', explanation: 'Ask God to send more workers into His harvest.', reference: 'Matthew 9:38' },
        { id: 16, category: 'Study of God\'s Word', title: 'Daily Bread', explanation: 'Read a portion of the Scriptures every single day.', reference: 'Matthew 4:4' },
        { id: 17, category: 'Study of God\'s Word', title: 'Hiding the Word', explanation: 'Commit verses of Scripture to memory for spiritual strength.', reference: 'Psalm 119:11' },
        { id: 18, category: 'Study of God\'s Word', title: 'Scripture Meditation', explanation: 'Ponder deeply on a single verse or passage.', reference: 'Psalm 1:2' },
        { id: 19, category: 'Study of God\'s Word', title: 'Book Study', explanation: 'Read and study an entire book of the Bible.', reference: 'Nehemiah 8:8' },
        { id: 20, category: 'Study of God\'s Word', title: 'Topical Study', explanation: 'Study what the whole Bible says about one subject.', reference: 'Acts 17:11' },
        { id: 21, category: 'Study of God\'s Word', title: 'Character Study', explanation: 'Study the life of a single person in the Bible.', reference: '1 Corinthians 10:11' },
        { id: 22, category: 'Study of God\'s Word', title: 'Read Proverbs Daily', explanation: 'Read the chapter of Proverbs that corresponds to the day.', reference: 'Proverbs 1:5' },
        { id: 23, category: 'Study of God\'s Word', title: 'Listening to the Word', explanation: 'Listen to an audio recording of the Holy Scriptures.', reference: 'Romans 10:17' },
        { id: 24, category: 'Study of God\'s Word', title: 'Public Reading', explanation: 'Read the Bible aloud to your family or another.', reference: '1 Timothy 4:13' },
        { id: 25, category: 'Study of God\'s Word', title: 'Teaching a Child', explanation: 'Teach a Bible story or verse to a child.', reference: 'Deuteronomy 6:7' },
        { id: 26, category: 'Study of God\'s Word', title: 'A Concordance Search', explanation: 'Use a concordance to trace a word through Scripture.', reference: '2 Timothy 2:15' },
        { id: 27, category: 'Study of God\'s Word', title: 'Compare Scripture', explanation: 'Compare verses to let Scripture interpret Scripture.', reference: '1 Corinthians 2:13' },
        { id: 28, category: 'Study of God\'s Word', title: 'Bible Outlining', explanation: 'Outline a chapter or book to see its structure.', reference: 'Luke 1:3' },
        { id: 29, category: 'Study of God\'s Word', title: 'Handwriting Scripture', explanation: 'Write out a chapter of the Bible by hand.', reference: 'Deuteronomy 17:18' },
        { id: 30, category: 'Study of God\'s Word', title: 'Heeding the Word', explanation: 'Make a specific plan to obey what you have read.', reference: 'James 1:22' },
        { id: 31, category: 'Worship & Adoration', title: 'Singing Hymns', explanation: 'Sing hymns of the faith, alone or with others.', reference: 'Colossians 3:16' },
        { id: 32, category: 'Worship & Adoration', title: 'Making a Joyful Noise', explanation: 'Praise God aloud with joyful, heartfelt expression.', reference: 'Psalm 100:1' },
        { id: 33, category: 'Worship & Adoration', title: 'Listing His Attributes', explanation: 'Make a list of God\'s character traits and praise Him.', reference: 'Psalm 145:3' },
        { id: 34, category: 'Worship & Adoration', title: 'Praising His Works', explanation: 'Thank God specifically for His mighty acts and creation.', reference: 'Psalm 150:2' },
        { id: 35, category: 'Worship & Adoration', title: 'Attending Church Faithfully', explanation: 'Do not forsake the assembly of the saints.', reference: 'Hebrews 10:25' },
        { id: 36, category: 'Worship & Adoration', title: 'Remembering the Lord\'s Supper', explanation: 'Partake in the ordinance with a solemn, thankful heart.', reference: '1 Corinthians 11:24' },
        { id: 37, category: 'Worship & Adoration', title: 'Respecting God\'s House', explanation: 'Behave with reverence and sobriety in the church building.', reference: 'Habakkuk 2:20' },
        { id: 38, category: 'Worship & Adoration', title: 'A Sabbath Rest', explanation: 'Set aside the Lord\'s Day for rest and worship.', reference: 'Exodus 20:8' },
        { id: 39, category: 'Worship & Adoration', title: 'Silent Adoration', explanation: 'Sit in silence, simply adoring God for who He is.', reference: 'Psalm 46:10' },
        { id: 40, category: 'Worship & Adoration', title: 'Voicing Praise', explanation: 'Tell another person something great God has done for you.', reference: 'Psalm 34:1' },
        { id: 41, category: 'Service & Fellowship', title: 'Encouraging a Brother', explanation: 'Speak a word of encouragement to a fellow believer.', reference: '1 Thessalonians 5:11' },
        { id: 42, category: 'Service & Fellowship', title: 'Visiting the Sick', explanation: 'Visit and pray with someone who is ill.', reference: 'Matthew 25:36' },
        { id: 43, category: 'Service & Fellowship', title: 'Hospitality', explanation: 'Open your home to a fellow believer for fellowship.', reference: 'Romans 12:13' },
        { id: 44, category: 'Service & Fellowship', title: 'Bearing Burdens', explanation: 'Help carry the load of someone who is struggling.', reference: 'Galatians 6:2' },
        { id: 45, category: 'Service & Fellowship', title: 'Serving in Church', explanation: 'Volunteer for a practical need within your local church.', reference: '1 Peter 4:10' },
        { id: 46, category: 'Service & Fellowship', title: 'A Phone Call of Care', explanation: 'Call someone from church just to check on them.', reference: '1 John 3:18' },
        { id: 47, category: 'Service & Fellowship', title: 'Writing a Note', explanation: 'Write a letter of encouragement to a pastor or missionary.', reference: '2 Corinthians 1:3-4' },
        { id: 48, category: 'Service & Fellowship', title: 'Caring for Widows', explanation: 'Provide practical help or comfort to a widow.', reference: 'James 1:27' },
        { id: 49, category: 'Service & Fellowship', title: 'Giving a Cup of Water', explanation: 'Perform a simple act of kindness in Christ\'s name.', reference: 'Matthew 10:42' },
        { id: 50, category: 'Service & Fellowship', title: 'Forgiving a Debt', explanation: 'Forgive someone who has wronged you, as Christ forgave.', reference: 'Ephesians 4:32' },
        { id: 51, category: 'Service & Fellowship', title: 'Restoring a Brother', explanation: 'Gently help a brother who has fallen into sin.', reference: 'Galatians 6:1' },
        { id: 52, category: 'Service & Fellowship', title: 'Submitting to One Another', explanation: 'Humbly prefer others and yield in love.', reference: 'Ephesians 5:21' },
        { id: 53, category: 'Service & Fellowship', title: 'Praying with a Believer', explanation: 'Ask another believer to pray with you about something specific.', reference: 'James 5:16' },
        { id: 54, category: 'Service & Fellowship', title: 'Mentoring a Younger Believer', explanation: 'Disciple someone who is newer in the faith.', reference: 'Titus 2:3-4' },
        { id: 55, category: 'Service & Fellowship', title: 'Honouring the Elderly', explanation: 'Show special respect and deference to the aged saints.', reference: 'Leviticus 19:32' },
        { id: 56, category: 'Personal Holiness & Discipleship', title: 'Examining Yourself', explanation: 'Test your own faith to see if you are in Christ.', reference: '2 Corinthians 13:5' },
        { id: 57, category: 'Personal Holiness & Discipleship', title: 'Mortifying the Flesh', explanation: 'Actively put to death the sinful deeds of the body.', reference: 'Romans 8:13' },
        { id: 58, category: 'Personal Holiness & Discipleship', title: 'Guarding Your Heart', explanation: 'Be watchful over the affections and motives of your heart.', reference: 'Proverbs 4:23' },
        { id: 59, category: 'Personal Holiness & Discipleship', title: 'Guarding Your Eyes', explanation: 'Be deliberate about what you allow yourself to see.', reference: 'Job 31:1' },
        { id: 60, category: 'Personal Holiness & Discipleship', title: 'Bridling Your Tongue', explanation: 'Practice speaking with grace and restrain from evil words.', reference: 'James 1:26' },
        { id: 61, category: 'Personal Holiness & Discipleship', title: 'Shunning Gossip', explanation: 'Refuse to listen to or spread unkind reports about others.', reference: 'Proverbs 20:19' },
        { id: 62, category: 'Personal Holiness & Discipleship', title: 'Practicing Humility', explanation: 'Consider others as better than yourself in lowliness of mind.', reference: 'Philippians 2:3' },
        { id: 63, category: 'Personal Holiness & Discipleship', title: 'Cultivating Patience', explanation: 'Practice enduring difficult situations or people without complaint.', reference: 'James 1:4' },
        { id: 64, category: 'Personal Holiness & Discipleship', title: 'Pursuing Peace', explanation: 'Actively seek to live peaceably with all men.', reference: 'Romans 12:18' },
        { id: 65, category: 'Personal Holiness & Discipleship', title: 'Choosing Godly Friends', explanation: 'Seek fellowship with those who walk in wisdom.', reference: 'Proverbs 13:20' },
        { id: 66, category: 'Personal Holiness & Discipleship', title: 'Redeeming the Time', explanation: 'Use your time wisely for eternal, not worldly, purposes.', reference: 'Ephesians 5:16' },
        { id: 67, category: 'Personal Holiness & Discipleship', title: 'Thinking on Good Things', explanation: 'Purposely focus your mind on things that are pure.', reference: 'Philippians 4:8' },
        { id: 68, category: 'Personal Holiness & Discipleship', title: 'Putting on Christ', explanation: 'Consciously seek to live and act like Jesus today.', reference: 'Romans 13:14' },
        { id: 69, category: 'Personal Holiness & Discipleship', title: 'A Media Fast', explanation: 'Abstain from television or internet for a set time.', reference: 'Psalm 101:3' },
        { id: 70, category: 'Personal Holiness & Discipleship', title: 'Contentment Practice', explanation: 'Find a reason to be content in your current circumstance.', reference: 'Philippians 4:11' },
        { id: 71, 'category': 'Personal Holiness & Discipleship', title: 'Fleeing Temptation', explanation: 'Physically remove yourself from a situation of temptation.', reference: '1 Corinthians 6:18' },
        { id: 72, category: 'Personal Holiness & Discipleship', title: 'Self-Denial', explanation: 'Deny yourself a legitimate pleasure for a spiritual purpose.', reference: 'Luke 9:23' },
        { id: 73, category: 'Personal Holiness & Discipleship', title: 'Practicing Honesty', explanation: 'Be scrupulously honest in a small, unseen matter.', reference: 'Luke 16:10' },
        { id: 74, category: 'Personal Holiness & Discipleship', title: 'Keeping a Promise', explanation: 'Fulfill a promise you made, keeping your word.', reference: 'Psalm 15:4' },
        { id: 75, category: 'Personal Holiness & Discipleship', title: 'A Grumbling Fast', explanation: 'Go a full day without complaining about anything.', reference: 'Philippians 2:14' },
        { id: 76, category: 'Evangelism & Witnessing', title: 'Giving a Testimony', explanation: 'Write out your testimony of salvation to share.', reference: 'Mark 5:19' },
        { id: 77, category: 'Evangelism & Witnessing', title: 'Praying for the Lost', explanation: 'Pray by name for the salvation of specific people.', reference: 'Romans 10:1' },
        { id: 78, category: 'Evangelism & Witnessing', title: 'Gospel Tract Distribution', explanation: 'Leave a gospel tract in a public place.', reference: 'Psalm 68:11' },
        { id: 79, category: 'Evangelism & Witnessing', title: 'Being Ready with an Answer', explanation: 'Prepare to explain the hope that is in you.', reference: '1 Peter 3:15' },
        { id: 80, category: 'Evangelism & Witnessing', title: 'Answering a Question', explanation: 'Answer a spiritual question someone asks with Scripture.', reference: 'Colossians 4:6' },
        { id: 81, category: 'Evangelism & Witnessing', title: 'Inviting to Church', explanation: 'Personally invite a friend or neighbor to a church service.', reference: 'Luke 14:23' },
        { id: 82, category: 'Evangelism & Witnessing', title: 'Living a Quiet Testimony', explanation: 'Let your good works be a silent witness at work.', reference: '1 Peter 2:12' },
        { id: 83, category: 'Evangelism & Witnessing', title: 'Sharing the Gospel', explanation: 'Intentionally share the plan of salvation with someone.', reference: 'Acts 1:8' },
        { id: 84, category: 'Evangelism & Witnessing', title: 'Supporting Missions', explanation: 'Give financially to the support of a missionary.', reference: 'Philippians 4:15-17' },
        { id: 85, category: 'Evangelism & Witnessing', title: 'Writing to a Missionary', explanation: 'Write a letter to a missionary on the field.', reference: '3 John 1:8' },
        { id: 86, category: 'Trust, Stewardship & Surrender', title: 'Tithing Cheerfully', explanation: 'Give the first tenth of your increase back to God.', reference: 'Malachi 3:10' },
        { id: 87, category: 'Trust, Stewardship & Surrender', title: 'Giving an Offering', explanation: 'Give a free-will offering above the tithe joyfully.', reference: '2 Corinthians 9:7' },
        { id: 88, category: 'Trust, Stewardship & Surrender', title: 'Casting Your Cares', explanation: 'Verbally give a specific anxiety over to the Lord.', reference: '1 Peter 5:7' },
        { id: 89, category: 'Trust, Stewardship & Surrender', title: 'Trusting in a Trial', explanation: 'Acknowledge God\'s sovereignty in the midst of a difficulty.', reference: 'Job 13:15' },
        { id: 90, category: 'Trust, Stewardship & Surrender', title: 'A "Commitment to God" Act', explanation: 'Make a conscious decision to commit one area of life to God.', reference: 'Proverbs 16:3' },
        { id: 91, category: 'Trust, Stewardship & Surrender', title: 'Acknowledging God', explanation: 'Verbally acknowledge God in a decision you have to make.', reference: 'Proverbs 3:6' },
        { id: 92, category: 'Trust, Stewardship & Surrender', title: 'Waiting on the LORD', explanation: 'Purposefully wait for God\'s timing without forcing a solution.', reference: 'Isaiah 40:31' },
        { id: 93, category: 'Trust, Stewardship & Surrender', title: 'A Stewardship Review', explanation: 'Review your finances and time, asking if they honor God.', reference: '1 Corinthians 4:2' },
        { id: 94, category: 'Trust, Stewardship & Surrender', title: 'Yielding Your Rights', explanation: 'Willingly give up a personal right for another\'s sake.', reference: '1 Corinthians 9:12' },
        { id: 95, category: 'Trust, Stewardship & Surrender', title: 'Remembering God\'s Faithfulness', explanation: 'Recount specific times God has been faithful in your past.', reference: 'Lamentations 3:22-23' },
        { id: 96, category: 'Trust, Stewardship & Surrender', title: 'Resting in Providence', explanation: 'Choose to trust God\'s unseen plan for your life.', reference: 'Romans 8:28' },
        { id: 97, category: 'Trust, Stewardship & Surrender', title: 'Labouring with Diligence', explanation: 'Do your daily work heartily, as unto the Lord.', reference: 'Colossians 3:23' },
        { id: 98, category: 'Trust, Stewardship & Surrender', title: 'Using Your Talents', explanation: 'Use a God-given ability for His glory, not your own.', reference: 'Matthew 25:21' },
        { id: 99, category: 'Trust, Stewardship & Surrender', title: 'Seeking Godly Counsel', explanation: 'Ask a wise, older believer for advice on a matter.', reference: 'Proverbs 11:14' },
        { id: 100, category: 'Trust, Stewardship & Surrender', title: 'A Final Surrender', explanation: 'End the day by saying, "Thy will be done."', reference: 'Luke 22:42' }
    ];

    // --- APPLICATION LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        // Get references to all the important elements on the page
        const getEl = (id) => document.getElementById(id);
        const navigationMenu = getEl('navigation-menu');
        const welcomeView = getEl('welcome-view');
        const welcomeHeader = getEl('welcome-header');
        const namePrompt = getEl('name-prompt');
        const nameInput = getEl('name-input');
        const nameSubmit = getEl('name-submit');
        const welcomeMessage = getEl('welcome-message');
        const favoritesView = getEl('favorites-view');
        const favoritesList = getEl('favorites-list');
        const exerciseView = getEl('exercise-view');
        const exerciseTitle = getEl('exercise-title');
        const favoriteStar = getEl('favorite-star');
        const exerciseExplanation = getEl('exercise-explanation');
        const exerciseReference = getEl('exercise-reference');
        const entryHistoryList = getEl('entry-history-list');
        const journalEntry = getEl('journal-entry');
        const saveButton = getEl('save-button');
        const saveFeedback = getEl('save-feedback');
        const mobileMenuToggle = getEl('mobile-menu-toggle');
        const sidebar = getEl('sidebar');
        const mainContent = getEl('main-content');
        const homeButton = getEl('home-button');
        const favoritesButton = getEl('favorites-button');
        const exportButton = getEl('export-button');
        const importButton = getEl('import-button');
        const importFileInput = getEl('import-file-input');
        const historyButton = getEl('history-button');
        const historyModal = getEl('history-modal');
        const modalCloseButton = getEl('modal-close-button');
        const historyTableBody = getEl('history-table-body');
        const startDateInput = getEl('start-date');
        const endDateInput = getEl('end-date');
        const filterButton = getEl('filter-button');

        let currentExerciseId = null;
        let favorites = [];
        let historyReportData = [];
        let currentSort = { key: 'date', order: 'desc' };

        // --- Data Handling ---
        const getFavorites = () => JSON.parse(localStorage.getItem('journalFavorites')) || [];
        const saveFavorites = () => localStorage.setItem('journalFavorites', JSON.stringify(favorites));

        // --- Name Personalization ---
        function setupWelcome() {
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                welcomeHeader.textContent = `Welcome, ${savedName}.`;
                namePrompt.style.display = 'none';
                welcomeMessage.style.display = 'block';
            } else {
                welcomeHeader.textContent = 'Welcome, Extreme Mission Christian.';
                namePrompt.style.display = 'block';
                welcomeMessage.style.display = 'none';
            }
        }

        function saveName() {
            const userName = nameInput.value.trim();
            if (userName) {
                localStorage.setItem('userName', userName);
                setupWelcome();
            }
        }

        // --- Favorites Logic ---
        function displayFavorites() {
            favorites = getFavorites();
            favoritesList.innerHTML = '';
            if (favorites.length > 0) {
                favorites.forEach(id => {
                    const exercise = spiritualExercises.find(ex => ex.id === id);
                    if (exercise) {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = `#exercise-${id}`;
                        a.dataset.id = id;
                        a.textContent = exercise.title;
                        li.appendChild(a);
                        favoritesList.appendChild(li);
                    }
                });
            } else {
                favoritesList.innerHTML = '<li><p>You haven\'t marked any exercises as favorites yet. Click the star icon on an exercise to add it here.</p></li>';
            }
        }

        function toggleFavorite() {
            if (currentExerciseId === null) return;
            const index = favorites.indexOf(currentExerciseId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(currentExerciseId);
            }
            saveFavorites();
            updateFavoriteStar();
        }

        function updateFavoriteStar() {
            if (favorites.includes(currentExerciseId)) {
                favoriteStar.classList.add('favorited');
                favoriteStar.title = "Remove from Favorites";
            } else {
                favoriteStar.classList.remove('favorited');
                favoriteStar.title = "Mark as Favorite";
            }
        }

        // --- Navigation & Display ---
        function populateNavMenu() {
            const categories = {};
            spiritualExercises.forEach(ex => {
                if (!categories[ex.category]) categories[ex.category] = [];
                categories[ex.category].push(ex);
            });

            navigationMenu.innerHTML = '';
            for (const category in categories) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-list';
                const categoryTitle = document.createElement('h3');
                categoryTitle.textContent = category;
                categoryDiv.appendChild(categoryTitle);
                const exerciseList = document.createElement('ul');
                exerciseList.className = 'exercise-list';
                categories[category].forEach(ex => {
                    const listItem = document.createElement('li');
                    listItem.className = 'exercise-list-item';
                    const link = document.createElement('a');
                    link.href = `#exercise-${ex.id}`;
                    link.textContent = `${ex.id}. ${ex.title}`;
                    link.dataset.id = ex.id;
                    listItem.appendChild(link);
                    exerciseList.appendChild(listItem);
                });
                categoryDiv.appendChild(exerciseList);
                navigationMenu.appendChild(categoryDiv);
            }
        }

        function showWelcomeScreen() {
            currentExerciseId = null;
            exerciseView.style.display = 'none';
            favoritesView.style.display = 'none';
            welcomeView.style.display = 'block';
            document.querySelectorAll('.exercise-list-item a').forEach(a => a.classList.remove('active'));
            setupWelcome();
        }

        function showFavoritesScreen() {
            currentExerciseId = null;
            exerciseView.style.display = 'none';
            welcomeView.style.display = 'none';
            favoritesView.style.display = 'block';
            document.querySelectorAll('.exercise-list-item a').forEach(a => a.classList.remove('active'));
            displayFavorites();
        }

        function renderEntryHistory(exerciseId) {
            const entriesJSON = localStorage.getItem(`journalEntry-${exerciseId}`);
            const entries = entriesJSON ? JSON.parse(entriesJSON) : [];
            entryHistoryList.innerHTML = '';
            // Display newest entries first
            entries.slice().reverse().forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'historical-entry';
                
                const metaDiv = document.createElement('div');
                metaDiv.className = 'entry-meta';
                metaDiv.textContent = new Date(entry.timestamp).toLocaleString();
                
                const textDiv = document.createElement('div');
                textDiv.className = 'entry-text';
                textDiv.textContent = entry.text;

                entryDiv.appendChild(metaDiv);
                entryDiv.appendChild(textDiv);
                entryHistoryList.appendChild(entryDiv);
            });
        }

        function showExercise(id) {
            currentExerciseId = parseInt(id);
            const exercise = spiritualExercises.find(ex => ex.id === currentExerciseId);

            if (exercise) {
                exerciseTitle.textContent = `${exercise.id}. ${exercise.title}`;
                exerciseExplanation.textContent = exercise.explanation;
                exerciseReference.textContent = exercise.reference;
                
                renderEntryHistory(currentExerciseId);
                journalEntry.value = ''; // Clear textarea for new entry

                updateFavoriteStar();
                welcomeView.style.display = 'none';
                favoritesView.style.display = 'none';
                exerciseView.style.display = 'block';

                document.querySelectorAll('.exercise-list-item a').forEach(a => a.classList.remove('active'));
                const activeLink = document.querySelector(`.exercise-list-item a[data-id='${currentExerciseId}']`);
                if (activeLink) {
                    activeLink.classList.add('active');
                    activeLink.closest('.category-list').classList.add('open');
                }
                
                if (window.innerWidth <= 768) sidebar.classList.remove('open');
            }
        }

        // --- Save Entry Logic (with Timestamp) ---
        function saveEntry() {
            if (currentExerciseId !== null && journalEntry.value.trim() !== '') {
                const entriesJSON = localStorage.getItem(`journalEntry-${currentExerciseId}`);
                const entries = entriesJSON ? JSON.parse(entriesJSON) : [];
                
                const newEntry = {
                    text: journalEntry.value.trim(),
                    timestamp: new Date().toISOString()
                };
                entries.push(newEntry);
                
                localStorage.setItem(`journalEntry-${currentExerciseId}`, JSON.stringify(entries));
                
                renderEntryHistory(currentExerciseId); // Re-render the history list
                journalEntry.value = ''; // Clear the textarea
                
                saveFeedback.style.opacity = 1;
                setTimeout(() => { saveFeedback.style.opacity = 0; }, 2000);
            }
        }

        // --- History Modal Logic ---
        function generateHistoryReport() {
            historyReportData = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('journalEntry-')) {
                    const exerciseId = parseInt(key.split('-')[1]);
                    const exercise = spiritualExercises.find(ex => ex.id === exerciseId);
                    const entries = JSON.parse(localStorage.getItem(key));

                    if (exercise && Array.isArray(entries)) {
                        entries.forEach(entry => {
                             if(entry.text) {
                                historyReportData.push({
                                    date: new Date(entry.timestamp),
                                    category: exercise.category,
                                    exercise: exercise.title,
                                    text: entry.text
                                });
                            }
                        });
                    }
                }
            }
        }

        function renderHistoryTable(data) {
            historyTableBody.innerHTML = '';
            if (data.length === 0) {
                historyTableBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">No entries found for the selected period.</td></tr>';
                return;
            }
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date.toLocaleDateString()}</td>
                    <td>${item.category}</td>
                    <td>${item.exercise}</td>
                `;
                historyTableBody.appendChild(row);
            });
        }
        
        function sortHistory(key) {
            const order = (currentSort.key === key && currentSort.order === 'asc') ? 'desc' : 'asc';
            currentSort = { key, order };
            
            historyReportData.sort((a, b) => {
                let valA = a[key];
                let valB = b[key];
                if (key === 'date') {
                    valA = valA.getTime();
                    valB = valB.getTime();
                }
                if (valA < valB) return order === 'asc' ? -1 : 1;
                if (valA > valB) return order === 'asc' ? 1 : -1;
                return 0;
            });
            
            document.querySelectorAll('.history-table th .sort-indicator').forEach(ind => ind.textContent = '');
            const indicator = document.querySelector(`.history-table th[data-sort="${key}"] .sort-indicator`);
            indicator.textContent = order === 'asc' ? '▲' : '▼';
            
            renderHistoryTable(historyReportData);
        }
        
        function filterHistory() {
            generateHistoryReport();
            let filteredData = historyReportData;
            const startDate = startDateInput.valueAsDate;
            const endDate = endDateInput.valueAsDate;

            if (startDate) {
                filteredData = filteredData.filter(item => item.date >= startDate);
            }
            if (endDate) {
                const inclusiveEndDate = new Date(endDate);
                inclusiveEndDate.setDate(inclusiveEndDate.getDate() + 1);
                filteredData = filteredData.filter(item => item.date < inclusiveEndDate);
            }
            
            historyReportData = filteredData;
            sortHistory(currentSort.key);
        }

        // --- Export and Import Logic ---
        function exportJournal() {
            const dataToExport = {
                userName: localStorage.getItem('userName') || '',
                journalFavorites: getFavorites(),
                journalEntries: {}
            };
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('journalEntry-')) {
                    dataToExport.journalEntries[key] = localStorage.getItem(key);
                }
            }
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `spiritual_journal_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importJournal(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data && (data.journalEntries || data.userName || data.journalFavorites)) {
                        if (confirm("This will overwrite your current journal. Are you sure you want to proceed?")) {
                            localStorage.clear();
                            if(data.userName) localStorage.setItem('userName', data.userName);
                            if(data.journalFavorites) localStorage.setItem('journalFavorites', JSON.stringify(data.journalFavorites));
                            if(data.journalEntries) {
                                for (const key in data.journalEntries) {
                                    localStorage.setItem(key, data.journalEntries[key]);
                                }
                            }
                            alert('Journal imported successfully! The page will now reload.');
                            location.reload();
                        }
                    } else {
                        alert('Error: Invalid journal file format.');
                    }
                } catch (error) {
                    alert('Error reading or parsing the file.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // --- Event Listeners ---
        nameSubmit.addEventListener('click', saveName);
        nameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') saveName(); });
        
        navigationMenu.addEventListener('click', (e) => {
            if (e.target.tagName === 'H3') e.target.parentElement.classList.toggle('open');
            if (e.target.tagName === 'A') { e.preventDefault(); showExercise(e.target.dataset.id); }
        });
        
        favoritesList.addEventListener('click', (e) => {
            if (e.target.tagName === 'A') { e.preventDefault(); showExercise(e.target.dataset.id); }
        });

        homeButton.addEventListener('click', showWelcomeScreen);
        favoritesButton.addEventListener('click', showFavoritesScreen);
        favoriteStar.addEventListener('click', toggleFavorite);
        saveButton.addEventListener('click', saveEntry);
        
        historyButton.addEventListener('click', () => {
            filterHistory();
            historyModal.style.display = 'flex';
        });
        modalCloseButton.addEventListener('click', () => historyModal.style.display = 'none');
        filterButton.addEventListener('click', filterHistory);
        document.querySelectorAll('.history-table th').forEach(th => th.addEventListener('click', () => sortHistory(th.dataset.sort)));

        exportButton.addEventListener('click', exportJournal);
        importButton.addEventListener('click', () => importFileInput.click());
        importFileInput.addEventListener('change', importJournal);

        mobileMenuToggle.addEventListener('click', () => sidebar.classList.toggle('open'));
        mainContent.addEventListener('click', () => { if (sidebar.classList.contains('open')) sidebar.classList.remove('open'); });
        
        // --- Initial Application Setup ---
        setupWelcome();
        populateNavMenu();
    });
    </script>
</body>
</html>
